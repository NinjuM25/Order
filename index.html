<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order-Hub</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 5px;
      background: #f4f4f9;
      overflow: hidden;
    }
    h2 {
      margin: 5px 0;
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 4px;
      text-align: center;
      word-wrap: break-word;
    }
    th {
      background: #007bff;
      color: white;
    }
    tr:nth-child(even) {
      background: #f9f9f9;
    }
    .subtotal-row {
      background: #e0e0e0;
      font-weight: bold;
    }
    button {
      padding: 6px 10px;
      margin: 2px;
      border: none;
      border-radius: 5px;
      background: #007bff;
      color: white;
      font-size: 12px;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    .summary-btns {
      text-align: center;
      margin: 5px 0;
    }
    .overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .overlay.active { display: flex; }
    .card {
      background: white;
      padding: 15px;
      border-radius: 10px;
      width: 95%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-sizing: border-box;
    }
    .card h3 { margin-top: 0; }
    .form-group { margin-bottom: 8px; }
    label {
      display: block;
      font-size: 12px;
      margin-bottom: 3px;
    }
    input, select {
      width: 100%;
      padding: 5px;
      font-size: 12px;
      box-sizing: border-box;
    }
    .actions { text-align: right; margin-top: 10px; }
    @media (max-width: 600px) {
      body, table, button, input, select { font-size: 11px; }
      button { padding: 5px 8px; }
    }
    #ordersContainer {
      height: 60vh;
      overflow-y: auto;
      background: white;
      border: 1px solid #ccc;
    }
    #itemSummaryContent, #summaryContent, #archiveList, #archiveDetailsContent {
      white-space: pre-wrap;
      font-size: 12px;
      line-height: 1.4;
      max-height: 60vh;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <h2>Order-Hub</h2>

  <div class="summary-btns">
    <button onclick="openAddItem()">Add Item</button>
    <button onclick="openSummary()">Generate Summary</button>
    <button onclick="openItemSummary()">Item Summary</button>
    <button onclick="openArchive()">View Archive</button>
    <button onclick="archiveOrders()">Archive Orders</button>
  </div>

  <div id="ordersContainer">
    <table id="ordersTable">
      <thead>
        <tr>
          <th>Buyer</th>
          <th>Category</th>
          <th>Item</th>
          <th>Price (NTD)</th>
          <th>Charge (NTD)</th>
          <th>Quantity</th>
          <th>Total (NTD)</th>
          <th>Balance</th>
          <th>Paid</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <td colspan="4"><b>Totals</b></td>
          <td id="totalCharge">0</td>
          <td id="totalQty">0</td>
          <td id="grandTotal">0</td>
          <td colspan="3"></td>
        </tr>
      </tfoot>
    </table>
  </div>

  <!-- Add Item Modal -->
  <div class="overlay" id="addItemModal">
    <div class="card">
      <h3>Add Item</h3>
      <div class="form-group">
        <label>Buyer Name</label>
        <input type="text" id="buyerNameInput">
      </div>
      <div class="form-group">
        <label>Category</label>
        <select id="categoryInput">
          <option value="">Select Category</option>
          <option value="Dry Goods">Dry Goods</option>
          <option value="Food Court">Food Court</option>
          <option value="Hotdog">Hotdog</option>
        </select>
      </div>
      <div class="form-group">
        <label>Item Name</label>
        <input type="text" id="itemNameInput">
      </div>
      <div class="form-group">
        <label>Price (NTD)</label>
        <input type="number" id="priceInput" min="0">
      </div>
      <div class="form-group">
        <label>Quantity</label>
        <input type="number" id="quantityInput" min="1" value="1">
      </div>
      <div class="actions">
        <button onclick="saveItem()">Save</button>
        <button onclick="closeAddItem()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Buyer Summary Modal -->
  <div class="overlay" id="summaryModal">
    <div class="card">
      <h3>Buyer Summary</h3>
      <div id="summaryContent"></div>
      <div class="actions">
        <button onclick="closeSummary()">Close</button>
      </div>
    </div>
  </div>

  <!-- Item Summary Modal -->
  <div class="overlay" id="itemSummaryModal">
    <div class="card">
      <h3>Item Summary</h3>
      <div id="itemSummaryContent"></div>
      <div class="actions">
        <button onclick="closeItemSummary()">Close</button>
      </div>
    </div>
  </div>

  <!-- Archive Modal -->
  <div class="overlay" id="archiveModal">
    <div class="card">
      <h3>Archived Orders</h3>
      <div id="archiveList"></div>
      <div class="actions">
        <button onclick="closeArchive()">Close</button>
      </div>
    </div>
  </div>

  <!-- Archive Details Modal -->
  <div class="overlay" id="archiveDetailsModal">
    <div class="card">
      <h3>Archive Details</h3>
      <div id="archiveDetailsContent"></div>
      <div class="actions">
        <button onclick="closeArchiveDetails()">Close</button>
      </div>
    </div>
  </div>

  <script>
    let orders = JSON.parse(localStorage.getItem('orders')) || {};
    let archives = JSON.parse(localStorage.getItem('archives')) || {};

    function openAddItem(){ document.getElementById('addItemModal').classList.add('active'); }
    function closeAddItem(){ document.getElementById('addItemModal').classList.remove('active'); }

    function saveItem(){
      const buyer = document.getElementById('buyerNameInput').value.trim();
      const category = document.getElementById('categoryInput').value;
      const itemName = document.getElementById('itemNameInput').value.trim();
      const price = parseFloat(document.getElementById('priceInput').value)||0;
      const quantity = parseInt(document.getElementById('quantityInput').value)||1;
      if(!buyer||!category||!itemName) return alert('Fill all fields');
      let charge = 0;
      if(category==='Dry Goods') charge=50;
      else if(category==='Food Court') charge=20;
      else if(category==='Hotdog') charge=30;
      const newItem={category,item:itemName,price,charge,quantity,balance:0,paid:false};
      if(!orders[buyer]) orders[buyer]=[];
      orders[buyer].push(newItem);
      localStorage.setItem('orders',JSON.stringify(orders));
      renderTable(); closeAddItem();
    }

    function renderTable(){
      const tbody=document.querySelector('#ordersTable tbody');
      tbody.innerHTML='';
      let totalCharge=0,totalQty=0,grandTotal=0;
      for(const buyer in orders){
        let buyerCharge=0,buyerQty=0,buyerTotal=0,buyerBalance=0;
        orders[buyer].forEach((order,idx)=>{
          const row=document.createElement('tr');
          if(!order.paid) row.style.backgroundColor='#fff3cd';
          row.innerHTML=`
            <td>${idx===0?buyer:''}</td>
            <td>${order.category}</td>
            <td>${order.item}</td>
            <td contenteditable="true" onblur="updateValue('${buyer}',${idx},'price',this.innerText)">${order.price}</td>
            <td contenteditable="true" onblur="updateValue('${buyer}',${idx},'charge',this.innerText)">${order.charge}</td>
            <td contenteditable="true" onblur="updateValue('${buyer}',${idx},'quantity',this.innerText)">${order.quantity}</td>
            <td>${(order.price+order.charge)*order.quantity}</td>
            <td contenteditable="true" onblur="updateValue('${buyer}',${idx},'balance',this.innerText)">${order.balance||0}</td>
            <td><input type="checkbox" ${order.paid?'checked':''} onchange="togglePaid('${buyer}',${idx},this.checked)"></td>
            <td><button onclick="deleteItem('${buyer}',${idx})">Delete</button></td>
          `;
          tbody.appendChild(row);
          buyerCharge+=order.charge*order.quantity;
          buyerQty+=order.quantity;
          buyerTotal+=(order.price+order.charge)*order.quantity;
          buyerBalance+=order.balance||0;
          totalCharge+=order.charge*order.quantity;
          totalQty+=order.quantity;
          grandTotal+=(order.price+order.charge)*order.quantity;
        });
        const subtotalRow=document.createElement('tr');
        subtotalRow.className='subtotal-row';
        subtotalRow.innerHTML=`
          <td colspan="3">Subtotal for ${buyer}</td>
          <td>-</td>
          <td>${buyerCharge}</td>
          <td>${buyerQty}</td>
          <td>${buyerTotal}</td>
          <td>${buyerBalance}</td>
          <td colspan="2">${orders[buyer].every(o=>o.paid)?'Paid':'Unpaid'}</td>
        `;
        tbody.appendChild(subtotalRow);
      }
      document.getElementById('totalCharge').innerText=totalCharge;
      document.getElementById('totalQty').innerText=totalQty;
      document.getElementById('grandTotal').innerText=grandTotal;
    }

    function updateValue(buyer,idx,field,value){
      if(field==='quantity') orders[buyer][idx][field]=parseInt(value)||1;
      else orders[buyer][idx][field]=parseFloat(value)||0;
      localStorage.setItem('orders',JSON.stringify(orders));
      renderTable();
    }
    function togglePaid(buyer,idx,checked){ orders[buyer][idx].paid=checked; localStorage.setItem('orders',JSON.stringify(orders)); renderTable(); }
    function deleteItem(buyer,idx){ orders[buyer].splice(idx,1); if(!orders[buyer].length) delete orders[buyer]; localStorage.setItem('orders',JSON.stringify(orders)); renderTable(); }

    function openSummary(){ let html='<table style="width:100%;border-collapse:collapse;font-size:12px;"><tr style="background:#007bff;color:white;"><th>Buyer</th><th>Total</th><th>Balance</th><th>Status</th></tr>'; for(const b in orders){ let bt=orders[b].reduce((s,o)=>s+(o.price+o.charge)*o.quantity,0); let bb=orders[b].reduce((s,o)=>s+(o.balance||0),0); let st=orders[b].every(o=>o.paid)?'Paid':'Unpaid'; html+=`<tr><td>${b}</td><td>${bt}</td><td>${bb}</td><td>${st}</td></tr>`;} html+='</table>'; document.getElementById('summaryContent').innerHTML=html; document.getElementById('summaryModal').classList.add('active'); }
    function closeSummary(){ document.getElementById('summaryModal').classList.remove('active'); }

    function openItemSummary(){ let items={}; for(const b in orders){ orders[b].forEach(o=>{items[o.item]=(items[o.item]||0)+o.quantity;}); } let text=''; for(const i in items) text+=`${i}: ${items[i]}\n`; document.getElementById('itemSummaryContent').innerText=text; document.getElementById('itemSummaryModal').classList.add('active'); }
    function closeItemSummary(){ document.getElementById('itemSummaryModal').classList.remove('active'); }

    function archiveOrders(){ if(Object.keys(orders).length===0) return alert('No orders'); let date=new Date().toLocaleString(); archives[date]=JSON.parse(JSON.stringify(orders)); localStorage.setItem('archives',JSON.stringify(archives)); orders={}; localStorage.setItem('orders',JSON.stringify(orders)); renderTable(); }
    function openArchive(){ let html='<table style="width:100%;border-collapse:collapse;font-size:12px;"><tr style="background:#007bff;color:white;"><th>Date</th><th>Actions</th></tr>'; for(const d in archives){ html+=`<tr><td>${d}</td><td><button onclick="viewArchiveDetails('${d}')">View</button><button onclick="restoreArchive('${d}')">Restore</button><button onclick="deleteArchive('${d}')">Delete</button></td></tr>`;} html+='</table>'; document.getElementById('archiveList').innerHTML=html; document.getElementById('archiveModal').classList.add('active'); }
    function closeArchive(){ document.getElementById('archiveModal').classList.remove('active'); }

    function viewArchiveDetails(date){ let html='<table style="width:100%;border-collapse:collapse;font-size:12px;"><tr style="background:#007bff;color:white;"><th>Buyer</th><th>Item</th><th>Price</th><th>Charge</th><th>Qty</th><th>Total</th></tr>'; let totalCharge=0; for(const b in archives[date]){ archives[date][b].forEach(o=>{ html+=`<tr><td>${b}</td><td>${o.item}</td><td>${o.price}</td><td>${o.charge}</td><td>${o.quantity}</td><td>${(o.price+o.charge)*o.quantity}</td></tr>`; totalCharge+=o.charge*o.quantity; }); } html+=`<tr class="subtotal-row"><td colspan="3">Total Charge</td><td colspan="3">${totalCharge}</td></tr>`; html+='</table>'; document.getElementById('archiveDetailsContent').innerHTML=html; document.getElementById('archiveDetailsModal').classList.add('active'); }
    function closeArchiveDetails(){ document.getElementById('archiveDetailsModal').classList.remove('active'); }

    function deleteArchive(date){ delete archives[date]; localStorage.setItem('archives',JSON.stringify(archives)); openArchive(); }
    function restoreArchive(date){ for(const b in archives[date]){ if(!orders[b]) orders[b]=[]; orders[b]=orders[b].concat(archives[date][b]); } delete archives[date]; localStorage.setItem('orders',JSON.stringify(orders)); localStorage.setItem('archives',JSON.stringify(archives)); renderTable(); openArchive(); }

    renderTable();
  </script>
</body>
</html>
